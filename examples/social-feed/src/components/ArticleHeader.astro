---
import type { HTMLAttributes } from 'astro/types';
import { Image } from 'astro:assets';
import { CollectionEntry } from 'astro:content';
import getReadingTime from 'reading-time';
import FormattedDate from './FormattedDate.astro';
import Icon from './Icon.astro';
import TagList from './TagList.astro';
import settings from '../settings.js';

interface Props extends HTMLAttributes<'header'> {
	article: CollectionEntry<'posts'>;
}

const { article, ...attrs } = Astro.props;

const { text: readingTime } = await getReadingTime(article.body);
---

<header {...attrs}>
	<a href="/" class="back">
		<Icon icon="arrow-left" color="var(--theme-accent-dark)" size="1.25rem" />
		<span>Back to feed</span>
	</a>

	<div class="cover">
		{
			article.data.cover && (
				<Image src={article.data.cover.src} alt={article.data.cover.alt} class="cover" />
			)
		}

		<div class="author">
			<Image src={settings.avatar.src} alt={settings.avatar.alt} width={80} />
			<p class="u-name">{settings.name}</p>
			<p class="u-nickname">{settings.username}</p>
		</div>
	</div>

	<div class="meta">
		<FormattedDate date={article.data.pubDate} />
		<span>â€¢</span>
		<p>
			<Icon icon="clock" size="1rem" />
			<span>{readingTime}</span>
		</p>
	</div>

	<h1>{article.data.title}</h1>

	{article.data.tags?.length > 0 && <TagList tags={article.data.tags} />}
</header>

<style>
	header {
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}

	.back {
		text-decoration: none;
		font-weight: bold;
	}

	.back {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		margin-inline-start: -4px;
	}

	.cover {
		position: relative;
		width: 100%;
		min-height: 150px;
		background: var(--theme-gradient-main);
		border-radius: 1.25rem;
		margin-bottom: 1.25rem;
	}

	.cover > img {
		width: 100%;
		height: 100%;
		aspect-ratio: 2.777;
		object-fit: cover;
	}

	.author {
		position: absolute;
		display: flex;
		align-items: center;
		gap: 0.5rem;
		bottom: 0%;
		right: 3.125rem;
		translate: 0 50%;
		box-shadow: var(--theme-shadow-md);
		background-color: var(--theme-accent-light);
		padding: 0.75rem 1.5rem;
		border-radius: 1.25rem;
		border: 3px solid var(--theme-accent-dark);
	}

	.author img {
		width: 2.5rem;
		height: 2.5rem;
	}

	.author .u-name {
		font-family: var(--font-brand);
		font-weight: bold;
	}

	.author .u-nickname {
		color: var(--theme-gray-300);
		font-size: var(--theme-text-sm);
		font-weight: 600;
	}

	.meta {
		display: flex;
		align-items: center;
		gap: 1rem;
		font-size: var(--theme-text-sm);
		color: var(--theme-gray-200);
	}

	.meta svg {
		margin-block-end: 0.25rem;
	}
</style>
